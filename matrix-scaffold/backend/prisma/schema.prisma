// Prisma Schema for Matrix Platform
// Global-Ready Architecture with PostgreSQL + pgvector

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enable pgvector extension
// Run: CREATE EXTENSION IF NOT EXISTS vector;

model Project {
  id          String   @id @default(uuid())
  name        String
  description String?
  userId      String?  // For multi-tenancy
  region      String?  @default("us-east-1")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  jobs        Job[]
  tasks       Task[]
  memories    Memory[]
  artifacts   Artifact[]

  @@index([userId])
  @@index([region])
  @@map("projects")
}

model Job {
  id        String   @id @default(uuid())
  projectId String
  status    String   @default("pending") // pending | running | completed | failed
  spec      Json     // JobSpec
  result    Json?    // Job result
  error     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  artifacts Artifact[]

  @@index([projectId])
  @@index([status])
  @@index([createdAt])
  @@map("jobs")
}

model Task {
  id        String   @id @default(uuid())
  projectId String
  type      String   // analysis | architecture | coding | testing | visual
  status    String   @default("queued") // queued | in_progress | completed | failed
  payload   Json?
  error     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([type, status])
  @@index([createdAt])
  @@map("tasks")
}

model Memory {
  id        String   @id @default(uuid())
  projectId String   @default("__org__") // "__org__" for org memory
  text      String   @db.Text
  vector    Unsupported("vector(256)")? // pgvector - 256 dimensions
  metadata  Json?
  createdAt DateTime @default(now())

  // Relations
  project Project? @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([createdAt])
  @@map("memory")
}

model Artifact {
  id        String   @id @default(uuid())
  jobId     String
  projectId String
  type      String   // png | html | thumb | log | generic
  path      String?
  url       String?  // CDN URL
  meta      Json?
  createdAt DateTime @default(now())

  // Relations
  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  job     Job     @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@index([jobId])
  @@index([projectId])
  @@index([type])
  @@map("artifacts")
}

model Bot {
  id        String   @id @default(uuid())
  name      String
  role      String   // morpheus | architect | sida | vision | audit
  status    String   @default("active") // active | inactive
  createdAt DateTime @default(now())

  @@index([role])
  @@index([status])
  @@map("bots")
}

model GraphEdge {
  id        String   @id @default(uuid())
  fromType  String   // Org | Project | Task | Job | Artifact | Memory
  fromId    String
  toType    String   // Org | Project | Task | Job | Artifact | Memory
  toId      String
  rel       String   // Relationship type
  createdAt DateTime @default(now())

  @@index([fromType, fromId])
  @@index([toType, toId])
  @@index([rel])
  @@map("graph_edges")
}

model AuditLog {
  id        String   @id @default(uuid())
  userId    String?
  action    String
  resource  String
  ip        String?
  userAgent String?
  timestamp DateTime @default(now())

  @@index([userId])
  @@index([action])
  @@index([timestamp])
  @@map("audit_logs")
}

model KpiSnapshot {
  id        String   @id @default(uuid())
  ts        DateTime @default(now())
  kpis      Json     // KPI data
  region    String   @default("us-east-1")

  @@index([ts])
  @@index([region])
  @@map("kpi_snapshots")
}

// Phase 4: Smart User Accounts
model User {
  id                String   @id @default(uuid())
  email             String   @unique
  name              String?
  avatar            String?
  password          String?   // Hashed password
  role              String   @default("user") // user | admin | enterprise
  emailVerified     Boolean  @default(false)
  verificationToken String?
  verificationExpires DateTime?
  twoFactorEnabled  Boolean  @default(false)
  twoFactorSecret   String?
  oauthProvider     String?  // google | github | microsoft
  oauthId           String?
  preferences       Json?    // Theme, language, notifications
  metadata          Json?
  lastLoginAt       DateTime?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  sessions          UserSession[]
  activities        UserActivity[]
  projects          Project[]
  memories          UserMemory[]
  referrals         Referral[] @relation("Referrer")
  referredBy        Referral? @relation("ReferredUser")
  points            UserPoints?
  subscriptions     Subscription[]
  billingHistory    BillingHistory[]
  notifications     Notification[]
  companionAgent    CompanionAgent?

  @@index([email])
  @@index([role])
  @@index([emailVerified])
  @@index([oauthProvider, oauthId])
  @@map("users")
}

model UserSession {
  id            String   @id @default(uuid())
  userId        String
  token         String   // Hashed token
  ip            String?
  userAgent     String?
  expiresAt     DateTime
  lastActivityAt DateTime @default(now())
  createdAt     DateTime @default(now())

  // Relations
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@index([expiresAt])
  @@map("user_sessions")
}

model UserActivity {
  id          String   @id @default(uuid())
  userId      String
  type        String   // login | logout | action | api_call | error
  description String
  metadata    Json?
  timestamp   DateTime @default(now())

  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([type])
  @@index([timestamp])
  @@map("user_activities")
}

// Phase 4: Personal AI Memory
model UserMemory {
  id        String   @id @default(uuid())
  userId    String
  text      String   @db.Text
  vector    Unsupported("vector(256)")? // pgvector - 256 dimensions
  metadata  Json?
  createdAt DateTime @default(now())

  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
  @@map("user_memories")
}

// Phase 4: Referral & Reward System
model Referral {
  id            String   @id @default(uuid())
  referrerId    String   // User who referred
  referredUserId String? // User who was referred
  token         String   @unique // Unique referral token
  status        String   @default("pending") // pending | completed | rewarded
  pointsEarned  Int      @default(0)
  createdAt     DateTime @default(now())
  completedAt   DateTime?

  // Relations
  referrer      User     @relation("Referrer", fields: [referrerId], references: [id])
  referredUser User?    @relation("ReferredUser", fields: [referredUserId], references: [id])

  @@index([referrerId])
  @@index([referredUserId])
  @@index([token])
  @@index([status])
  @@map("referrals")
}

model UserPoints {
  id            String   @id @default(uuid())
  userId        String   @unique
  totalPoints   Int      @default(0)
  aiCredits     Int      @default(0)
  tier          String   @default("bronze") // bronze | silver | gold | diamond
  referralsCount Int     @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([tier])
  @@map("user_points")
}

// Phase 4: Billing & Subscriptions
model Subscription {
  id                String   @id @default(uuid())
  userId            String
  tier              String   // free | pro | enterprise | custom
  status            String   @default("active") // active | cancelled | expired | suspended | trial
  paymentProvider    String   // stripe | paypal | crypto
  paymentMethodId   String?
  currentPeriodStart DateTime @default(now())
  currentPeriodEnd   DateTime
  cancelAtPeriodEnd  Boolean  @default(false)
  trialEnd          DateTime?
  metadata          Json?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  invoices          Invoice[]
  usageMetrics      UsageMetrics[]
  apiKeys           APIKey[]
  instances         PrivateInstance[]
  licenses          License[]

  @@index([userId])
  @@index([status])
  @@index([tier])
  @@map("subscriptions")
}

model BillingHistory {
  id            String   @id @default(uuid())
  userId        String
  type          String   // subscription | purchase | refund
  amount        Float
  currency      String   @default("USD")
  status        String   // pending | completed | failed
  paymentMethod String?  // stripe | paypal | crypto
  transactionId String?
  metadata      Json?
  createdAt     DateTime @default(now())

  // Relations
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@map("billing_history")
}

// Phase 4: Advanced Notifications
model Notification {
  id          String   @id @default(uuid())
  userId      String
  type        String   // info | warning | error | success | system
  title       String
  message     String   @db.Text
  read        Boolean  @default(false)
  actionUrl   String?
  metadata    Json?
  createdAt   DateTime @default(now())
  readAt      DateTime?

  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([read])
  @@index([type])
  @@index([createdAt])
  @@map("notifications")
}

// Phase 4: Personal Companion AI
model CompanionAgent {
  id            String   @id @default(uuid())
  userId        String   @unique
  name          String   @default("My Companion")
  personality   Json?    // AI personality traits
  memory        Json?    // Learned preferences
  stats         Json?    // Usage statistics
  enabled       Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([enabled])
  @@map("companion_agents")
}

// Phase 8: AI Rental & Commercial Deployment

model Invoice {
  id              String   @id @default(uuid())
  subscriptionId  String
  userId          String
  amount          Float
  currency        String   @default("USD")
  status          String   @default("draft") // draft | open | paid | void | uncollectible
  periodStart     DateTime
  periodEnd       DateTime
  items           Json     // InvoiceItem[]
  paymentProvider String   // stripe | paypal | crypto
  paymentIntentId String?
  paidAt          DateTime?
  dueDate         DateTime
  createdAt       DateTime @default(now())

  // Relations
  subscription    Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)

  @@index([subscriptionId])
  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@map("invoices")
}

model UsageMetrics {
  id              String       @id @default(uuid())
  subscriptionId  String
  periodStart     DateTime
  periodEnd       DateTime
  requests        Int          @default(0)
  tokens          Int          @default(0)
  cost            Float        @default(0)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  // Relations
  subscription    Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)

  @@unique([subscriptionId, periodStart])
  @@index([subscriptionId])
  @@index([periodStart])
  @@map("usage_metrics")
}

model APIKey {
  id              String   @id @default(uuid())
  userId          String
  subscriptionId  String?
  key             String   @unique
  name            String
  status          String   @default("active") // active | revoked | expired | suspended
  rateLimit       Json     // RateLimit
  usage           Json     // UsageStats
  allowedAIs      String[] // AI IDs that can be accessed
  metadata        Json?
  createdAt       DateTime @default(now())
  lastUsedAt      DateTime?
  expiresAt       DateTime?

  // Relations
  subscription    Subscription? @relation(fields: [subscriptionId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([subscriptionId])
  @@index([status])
  @@index([key])
  @@map("api_keys")
}

model AIListing {
  id              String   @id @default(uuid())
  name            String
  description     String   @db.Text
  type            String   // nicholas | surooh | lida | bot | model | custom
  capabilities    String[]
  price           Json     // Pricing
  usageCapacity   Json     // UsageCapacity
  status          String   @default("available") // available | purchased | subscribed | private
  metadata        Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  purchases       Purchase[]
  reviews         Review[]

  @@index([type])
  @@index([status])
  @@map("ai_listings")
}

model Purchase {
  id              String   @id @default(uuid())
  userId          String
  aiId            String
  pricingModel    String   // instant | monthly | custom | private
  subscriptionId  String?
  instanceId      String?
  amount          Float
  currency        String   @default("USD")
  status          String   @default("pending") // pending | completed | failed | cancelled
  createdAt       DateTime @default(now())
  completedAt     DateTime?

  // Relations
  listing         AIListing @relation(fields: [aiId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([aiId])
  @@index([status])
  @@index([createdAt])
  @@map("purchases")
}

model Review {
  id              String   @id @default(uuid())
  aiId            String
  userId          String
  rating          Int      // 1-5
  title           String
  content         String   @db.Text
  verified        Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  listing         AIListing @relation(fields: [aiId], references: [id], onDelete: Cascade)

  @@index([aiId])
  @@index([userId])
  @@index([rating])
  @@index([createdAt])
  @@map("reviews")
}

model PrivateInstance {
  id              String   @id @default(uuid())
  userId          String
  subscriptionId String
  name            String
  type            String   // nicholas | surooh | lida | bot | model | custom
  status          String   @default("active") // active | suspended | expired | deleted
  resources       Json     // InstanceResources
  performance     Json     // InstancePerformance
  metadata        Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  expiresAt       DateTime?

  // Relations
  subscription    Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([subscriptionId])
  @@index([status])
  @@map("private_instances")
}

model License {
  id              String   @id @default(uuid())
  userId          String
  subscriptionId  String?
  aiId            String
  type            String   // personal | commercial | reseller | custom
  status          String   @default("active") // active | expired | revoked | suspended
  terms           Json     // LicenseTerms
  metadata        Json?
  issuedAt        DateTime @default(now())
  expiresAt       DateTime?
  revokedAt       DateTime?

  // Relations
  subscription    Subscription? @relation(fields: [subscriptionId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([subscriptionId])
  @@index([aiId])
  @@index([status])
  @@map("licenses")
}

model ComplianceCheck {
  id              String   @id @default(uuid())
  userId          String
  subscriptionId String?
  status          String   // compliant | non_compliant | pending
  checks          Json     // ComplianceCheckItem[]
  passed          Boolean
  checkedAt       DateTime @default(now())

  @@index([userId])
  @@index([subscriptionId])
  @@index([status])
  @@index([checkedAt])
  @@map("compliance_checks")
}

model UsageReport {
  id              String   @id @default(uuid())
  userId          String
  subscriptionId String?
  period          String   // daily | weekly | monthly | custom
  periodStart     DateTime
  periodEnd       DateTime
  summary         Json     // UsageSummary
  details         Json     // UsageDetail[]
  generatedAt     DateTime @default(now())

  @@index([userId])
  @@index([subscriptionId])
  @@index([period])
  @@index([generatedAt])
  @@map("usage_reports")
}

model InvoiceReport {
  id              String   @id @default(uuid())
  userId          String
  periodStart     DateTime
  periodEnd       DateTime
  summary         Json     // InvoiceSummary
  invoices        String[] // Invoice IDs
  generatedAt     DateTime @default(now())

  @@index([userId])
  @@index([generatedAt])
  @@map("invoice_reports")
}

// Phase 8.1: AI Rental Dashboard & Client Panel

model ClientProfile {
  id              String   @id @default(uuid())
  userId          String   @unique
  email           String
  name            String
  language        String   @default("en") // en | ar
  timezone        String?
  preferences     Json     // ClientPreferences
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([userId])
  @@index([email])
  @@map("client_profiles")
}

model ClientSession {
  id              String   @id @default(uuid())
  userId          String
  token           String   @unique
  ipAddress       String?
  userAgent       String?
  createdAt       DateTime @default(now())
  expiresAt       DateTime
  lastActivityAt  DateTime @default(now())

  @@index([userId])
  @@index([token])
  @@index([expiresAt])
  @@map("client_sessions")
}

model Ticket {
  id              String   @id @default(uuid())
  userId          String
  type            String   // issue | question | feature_request | billing | technical
  priority        String   @default("medium") // low | medium | high | urgent
  status          String   @default("open") // open | in_progress | resolved | closed
  subject         String
  description     String   @db.Text
  messages        Json     // TicketMessage[]
  assignedTo     String?
  metadata        Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  resolvedAt      DateTime?
  closedAt        DateTime?

  @@index([userId])
  @@index([status])
  @@index([priority])
  @@index([assignedTo])
  @@index([createdAt])
  @@map("tickets")
}

model ClientNotification {
  id              String   @id @default(uuid())
  userId          String
  type            String   // billing | usage | system | support
  channel         String   @default("in_app") // in_app | email | telegram | discord
  status          String   @default("unread") // unread | read | archived
  title           String
  message         String   @db.Text
  actionUrl       String?
  metadata        Json?
  createdAt       DateTime @default(now())
  readAt          DateTime?
  archivedAt      DateTime?

  @@index([userId])
  @@index([type])
  @@index([status])
  @@index([channel])
  @@index([createdAt])
  @@map("client_notifications")
}

model TwoFactorAuth {
  id              String   @id @default(uuid())
  userId          String   @unique
  enabled         Boolean  @default(false)
  secret          String?
  backupCodes     String[]
  createdAt       DateTime @default(now())
  verifiedAt      DateTime?

  @@index([userId])
  @@map("two_factor_auth")
}

// Phase 8.4: Developer Marketplace & AI Runtime

model Developer {
  id                String   @id @default(uuid())
  userId            String   @unique
  email             String
  name              String
  company           String?
  status            String   @default("pending") // pending | verified | suspended | rejected
  verificationLevel String   @default("email") // email | kyc | full
  tier              String   @default("free") // free | pro | enterprise
  walletId          String   @unique
  profile           Json     // DeveloperProfile
  portfolio         Json     // DeveloperPortfolio
  kycData           Json?    // KYCData
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  apps              App[]
  wallet            DeveloperWallet?
  withdrawals       Withdrawal[]

  @@index([userId])
  @@index([status])
  @@index([verificationLevel])
  @@map("developers")
}

model App {
  id              String   @id @default(uuid())
  developerId     String
  name            String
  slug            String   @unique
  description     String   @db.Text
  longDescription String?  @db.Text
  category        String
  tags            String[]
  version         String   @default("1.0.0")
  status          String   @default("draft") // draft | pending | reviewing | approved | rejected | published | suspended
  accessLevel     String   @default("private") // public | private | premium | enterprise
  licenseType     String   @default("closed_source") // open_source | closed_source | commercial | custom
  pricing         Json     // Pricing
  sourceCode      String?  @db.Text
  repository      String?
  icon            String?
  screenshots     String[]
  video           String?
  documentation  String?  @db.Text
  requirements    String[]
  features        String[]
  changelog       String?  @db.Text
  licenseKey      String?
  usageTokens     Int?
  totalDownloads Int      @default(0)
  totalRevenue    Float    @default(0)
  rating          Float    @default(0)
  reviews         Int      @default(0)
  metadata        Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  publishedAt     DateTime?

  // Relations
  developer       Developer @relation(fields: [developerId], references: [id], onDelete: Cascade)
  versions        AppVersion[]
  installations   AppInstallation[]
  appReviews      AppReview[]
  revenueShares   RevenueShare[]
  scanResults     CodeScanResult[]

  @@index([developerId])
  @@index([status])
  @@index([category])
  @@index([slug])
  @@map("apps")
}

model AppVersion {
  id              String   @id @default(uuid())
  appId           String
  version         String
  status          String   @default("draft") // draft | published | deprecated | archived
  compatibility   String   @default("backward_compatible") // backward_compatible | breaking | major | minor | patch
  changelog       String?  @db.Text
  sourceCode      String   @db.Text
  runtimeConfig   Json?
  apiTokens       String[]
  endpoints       String[]
  isStable        Boolean  @default(false)
  isDefault        Boolean  @default(false)
  createdAt       DateTime @default(now())
  publishedAt     DateTime?
  deprecatedAt    DateTime?

  // Relations
  app             App      @relation(fields: [appId], references: [id], onDelete: Cascade)
  appTokens       AppToken[]

  @@unique([appId, version])
  @@index([appId])
  @@index([status])
  @@map("app_versions")
}

model AppToken {
  id                String   @id @default(uuid())
  appId             String
  version           String
  token             String   @unique
  name              String
  permissions       String[]
  rateLimit         Json     // RateLimit
  isActive          Boolean  @default(true)
  expiresAt         DateTime?
  createdAt         DateTime @default(now())

  // Relations
  appVersion        AppVersion @relation(fields: [appId, version], references: [appId, version], onDelete: Cascade)

  @@index([appId])
  @@index([token])
  @@index([isActive])
  @@map("app_tokens")
}

model AppInstance {
  id              String   @id @default(uuid())
  appId           String
  developerId     String
  version         String
  status          String   @default("pending") // pending | running | stopped | error
  containerId     String?
  runtimeConfig   Json     // RuntimeConfig
  resourceUsage   Json     // ResourceUsage
  endpoint        String   @unique
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  metrics         RuntimeMetrics[]

  @@index([appId])
  @@index([developerId])
  @@index([status])
  @@map("app_instances")
}

model RuntimeMetrics {
  id              String   @id @default(uuid())
  instanceId     String
  cpu             Float
  memory          Float
  storage         Float
  requests        Int      @default(0)
  errors          Int      @default(0)
  latency         Float
  uptime          Int
  timestamp       DateTime @default(now())

  // Relations
  instance       AppInstance @relation(fields: [instanceId], references: [id], onDelete: Cascade)

  @@index([instanceId])
  @@index([timestamp])
  @@map("runtime_metrics")
}

model DeveloperWallet {
  id              String   @id @default(uuid())
  developerId     String   @unique
  balance         Float    @default(0)
  currency        String   @default("USD")
  pendingBalance  Float    @default(0)
  totalEarned     Float    @default(0)
  totalWithdrawn  Float    @default(0)
  lastUpdated     DateTime @default(now())

  // Relations
  developer       Developer @relation(fields: [developerId], references: [id], onDelete: Cascade)

  @@index([developerId])
  @@map("developer_wallets")
}

model RevenueShare {
  id                String   @id @default(uuid())
  transactionId     String
  appId             String
  developerId       String
  userId            String
  amount            Float
  currency          String   @default("USD")
  developerShare    Float
  platformShare     Float
  developerPercentage Float
  platformPercentage Float
  type              String   // subscription | one_time | usage | commission
  status            String   @default("pending") // pending | processing | completed | failed
  processedAt       DateTime?
  metadata          Json?
  createdAt         DateTime @default(now())

  // Relations
  app               App      @relation(fields: [appId], references: [id], onDelete: Cascade)

  @@index([appId])
  @@index([developerId])
  @@index([status])
  @@index([createdAt])
  @@map("revenue_shares")
}

model Withdrawal {
  id              String   @id @default(uuid())
  developerId     String
  amount          Float
  currency        String   @default("USD")
  walletAddress   String?
  bankAccount     String?
  paymentMethod   String   // crypto | bank | paypal | stripe
  status          String   @default("pending") // pending | processing | completed | failed
  processedAt     DateTime?
  transactionHash String?
  createdAt       DateTime @default(now())

  // Relations
  developer       Developer @relation(fields: [developerId], references: [id], onDelete: Cascade)

  @@index([developerId])
  @@index([status])
  @@index([createdAt])
  @@map("withdrawals")
}

model CodeScanResult {
  id              String   @id @default(uuid())
  appId           String
  version         String
  status          String   @default("pending") // pending | scanning | completed | failed
  riskLevel       String   @default("low") // low | medium | high | critical
  issues          Json     // ScanIssue[]
  score           Int      // 0-100
  metadata        Json?
  scannedAt       DateTime @default(now())

  // Relations
  app             App      @relation(fields: [appId], references: [id], onDelete: Cascade)

  @@index([appId])
  @@index([version])
  @@index([riskLevel])
  @@map("code_scan_results")
}

model SecurityAudit {
  id              String   @id @default(uuid())
  appId           String
  developerId     String
  action          String   // publish | update | delete | approve | reject
  scanResultId    String?
  riskLevel       String   @default("low") // low | medium | high | critical
  approved        Boolean  @default(false)
  approvedBy      String?
  notes           String?  @db.Text
  createdAt       DateTime @default(now())

  @@index([appId])
  @@index([developerId])
  @@index([action])
  @@index([createdAt])
  @@map("security_audits")
}

model AppReview {
  id              String   @id @default(uuid())
  appId           String
  userId          String
  rating          Int      // 1-5
  title           String?
  comment         String?  @db.Text
  status          String   @default("pending") // pending | approved | rejected
  helpful         Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  app             App      @relation(fields: [appId], references: [id], onDelete: Cascade)

  @@index([appId])
  @@index([userId])
  @@index([status])
  @@index([rating])
  @@map("app_reviews")
}

model AppInstallation {
  id              String   @id @default(uuid())
  appId           String
  userId          String
  version         String
  instanceId      String?
  status          String   @default("installed") // installed | running | stopped | uninstalled
  installedAt     DateTime @default(now())
  lastUsedAt      DateTime?

  // Relations
  app             App      @relation(fields: [appId], references: [id], onDelete: Cascade)

  @@index([appId])
  @@index([userId])
  @@index([status])
  @@map("app_installations")
}

// Phase 8.2: Partner & Reseller Portal

model Partner {
  id              String   @id @default(uuid())
  name            String
  email           String
  subdomain       String   @unique
  domain          String?
  logo            String?
  theme           Json?    // PartnerTheme
  status          String   @default("pending") // active | suspended | pending | inactive
  tier            String   @default("bronze") // bronze | silver | gold | platinum
  commissionRate  Float    @default(10)
  customPricing   Json?
  metadata        Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  members         PartnerMember[]
  resellers       Reseller[]
  commissions     Commission[]
  payouts         Payout[]
  oauthClients    PartnerOAuthClient[]
  brandConfig     BrandConfig?
  auditLogs       PartnerAuditLog[]

  @@index([status])
  @@index([tier])
  @@index([subdomain])
  @@map("partners")
}

model PartnerMember {
  id              String   @id @default(uuid())
  partnerId       String
  userId          String
  role            String   // owner | manager | sales | support | viewer
  email           String
  name            String
  permissions     String[]
  createdAt       DateTime @default(now())

  // Relations
  partner         Partner  @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  @@index([partnerId])
  @@index([userId])
  @@map("partner_members")
}

model Reseller {
  id              String   @id @default(uuid())
  partnerId       String
  name            String
  email           String
  status          String   @default("pending") // active | suspended | pending | inactive
  commissionRate  Float    @default(5)
  customPricing   Json?
  metadata        Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  partner         Partner  @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  customers      ResellerCustomer[]
  commissions    Commission[]

  @@index([partnerId])
  @@index([status])
  @@map("resellers")
}

model ResellerCustomer {
  id              String   @id @default(uuid())
  resellerId      String
  userId          String
  email           String
  name            String
  subscriptionId String?
  createdAt       DateTime @default(now())

  // Relations
  reseller        Reseller @relation(fields: [resellerId], references: [id], onDelete: Cascade)

  @@index([resellerId])
  @@index([userId])
  @@map("reseller_customers")
}

model Commission {
  id              String   @id @default(uuid())
  partnerId       String
  resellerId      String?
  type            String   // sale | subscription | recurring
  amount          Float
  currency        String   @default("USD")
  percentage      Float
  saleAmount      Float
  status          String   @default("pending") // pending | processing | completed | failed
  payoutId        String?
  saleId          String?
  subscriptionId  String?
  metadata        Json?
  createdAt       DateTime @default(now())
  paidAt          DateTime?

  // Relations
  partner         Partner  @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  reseller        Reseller? @relation(fields: [resellerId], references: [id], onDelete: SetNull)
  payout          Payout?   @relation(fields: [payoutId], references: [id], onDelete: SetNull)

  @@index([partnerId])
  @@index([resellerId])
  @@index([status])
  @@index([payoutId])
  @@index([createdAt])
  @@map("commissions")
}

model Payout {
  id              String   @id @default(uuid())
  partnerId       String
  amount          Float
  currency        String   @default("USD")
  status          String   @default("pending") // pending | processing | completed | failed
  paymentProvider String   // stripe | paypal
  paymentMethodId String
  commissions     String[] // Commission IDs
  scheduledAt     DateTime
  processedAt     DateTime?
  metadata        Json?
  createdAt       DateTime @default(now())

  // Relations
  partner         Partner  @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  commissionList  Commission[]

  @@index([partnerId])
  @@index([status])
  @@index([scheduledAt])
  @@map("payouts")
}

model PartnerOAuthClient {
  id              String   @id @default(uuid())
  partnerId       String
  clientId        String   @unique
  clientSecret    String
  redirectUris    String[]
  scopes          String[]
  rateLimit       Json     // RateLimit
  createdAt       DateTime @default(now())

  // Relations
  partner         Partner  @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  @@index([partnerId])
  @@index([clientId])
  @@map("partner_oauth_clients")
}

model BrandConfig {
  id              String   @id @default(uuid())
  partnerId       String   @unique
  brandName       String
  logo            String?
  favicon         String?
  theme           Json     // BrandTheme
  domain          String?
  subdomain       String?
  sslEnabled      Boolean  @default(true)
  regionPricing   Json?
  customColors    Json?
  customFonts     Json?
  metadata        Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  partner         Partner  @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  @@index([partnerId])
  @@index([domain])
  @@index([subdomain])
  @@map("brand_configs")
}

model PartnerAuditLog {
  id              String   @id @default(uuid())
  partnerId       String
  userId          String
  action          String   // create | update | delete | suspend | activate | payment | payout
  resource        String
  resourceId      String?
  changes         Json?
  ipAddress       String?
  userAgent       String?
  timestamp       DateTime @default(now())

  // Relations
  partner         Partner  @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  @@index([partnerId])
  @@index([userId])
  @@index([action])
  @@index([timestamp])
  @@map("partner_audit_logs")
}

// Phase 8.3: Enterprise Enhancements

model Webhook {
  id              String   @id @default(uuid())
  userId          String?
  partnerId       String?
  url             String
  events          String[] // WebhookEventType[]
  secret          String?
  active          Boolean  @default(true)
  retries         Int      @default(3)
  timeout         Int      @default(30000)
  headers         Json?
  metadata        Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  deliveries      WebhookDelivery[]

  @@index([userId])
  @@index([partnerId])
  @@index([active])
  @@map("webhooks")
}

model WebhookDelivery {
  id              String   @id @default(uuid())
  webhookId       String
  event           Json     // WebhookEvent
  status          String   // pending | delivered | failed
  attempts        Int      @default(0)
  responseCode    Int?
  responseBody    String?  @db.Text
  deliveredAt     DateTime?
  failedAt        DateTime?
  error           String?  @db.Text
  createdAt       DateTime @default(now())

  // Relations
  webhook         Webhook  @relation(fields: [webhookId], references: [id], onDelete: Cascade)

  @@index([webhookId])
  @@index([status])
  @@index([createdAt])
  @@map("webhook_deliveries")
}

model TaxRate {
  id              String   @id @default(uuid())
  region          String   // EU | US | CA | UK | AU | SG | IN | OTHER
  country         String
  state           String?
  type            String   // vat | gst | sales_tax | custom
  rate            Float    // Percentage
  name            String
  description     String?  @db.Text
  effectiveFrom   DateTime @default(now())
  effectiveTo     DateTime?
  isActive        Boolean  @default(true)

  @@index([country])
  @@index([state])
  @@index([type])
  @@index([isActive])
  @@map("tax_rates")
}

model TaxExemption {
  id              String   @id @default(uuid())
  userId          String
  country         String
  reason          String   @db.Text
  taxNumber       String?
  validFrom       DateTime @default(now())
  validTo         DateTime?
  isActive        Boolean  @default(true)

  @@index([userId])
  @@index([country])
  @@index([isActive])
  @@map("tax_exemptions")
}

model Refund {
  id              String   @id @default(uuid())
  invoiceId       String
  userId          String
  subscriptionId  String?
  amount          Float
  currency        String   @default("USD")
  type            String   // full | partial | prorated
  reason          String   // customer_request | duplicate_charge | fraudulent | service_issue | billing_error | other
  status          String   @default("pending") // pending | processing | completed | failed | cancelled
  description     String?  @db.Text
  paymentProvider String   // stripe | paypal | crypto
  paymentIntentId String?
  refundId        String?
  processedAt     DateTime?
  metadata        Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  disputes        Dispute[]

  @@index([invoiceId])
  @@index([userId])
  @@index([subscriptionId])
  @@index([status])
  @@index([createdAt])
  @@map("refunds")
}

model Dispute {
  id              String   @id @default(uuid())
  refundId        String
  userId          String
  reason          String   @db.Text
  evidence        String[]
  status          String   @default("open") // open | under_review | resolved | closed
  resolution      String?  @db.Text
  createdAt       DateTime @default(now())
  resolvedAt      DateTime?

  // Relations
  refund          Refund   @relation(fields: [refundId], references: [id], onDelete: Cascade)

  @@index([refundId])
  @@index([userId])
  @@index([status])
  @@map("disputes")
}

model SLADefinition {
  id              String   @id @default(uuid())
  tier            String   // free | pro | enterprise | custom
  name            String
  uptimeTarget    Float    // Percentage
  latencyTarget    Float    // Milliseconds
  throughputTarget Float    // Requests per second
  errorRateTarget  Float    // Percentage
  description     String?  @db.Text
  isActive        Boolean  @default(true)

  @@index([tier])
  @@index([isActive])
  @@map("sla_definitions")
}

model SLAMetrics {
  id              String   @id @default(uuid())
  subscriptionId  String
  userId          String
  tier            String
  periodStart     DateTime
  periodEnd       DateTime
  uptime          Float    // Percentage
  latency         Float    // Average milliseconds
  throughput      Float    // Requests per second
  errorRate       Float    // Percentage
  status          String   // met | at_risk | breached
  breaches        Int      @default(0)
  lastChecked     DateTime @default(now())

  @@unique([subscriptionId, periodStart])
  @@index([subscriptionId])
  @@index([userId])
  @@index([status])
  @@map("sla_metrics")
}

model SLAAlert {
  id              String   @id @default(uuid())
  subscriptionId  String
  userId          String
  metric          String   // uptime | latency | throughput | error_rate
  currentValue    Float
  targetValue     Float
  severity        String   // warning | critical
  status          String   @default("open") // open | acknowledged | resolved
  createdAt       DateTime @default(now())
  resolvedAt      DateTime?

  @@index([subscriptionId])
  @@index([userId])
  @@index([status])
  @@index([severity])
  @@map("sla_alerts")
}

model CurrencyConfig {
  id                String   @id @default(uuid())
  userId            String?
  partnerId         String?
  defaultCurrency   String   @default("USD")
  supportedCurrencies String[] // Currency[]
  autoConvert       Boolean  @default(true)
  metadata          Json?

  @@unique([userId])
  @@unique([partnerId])
  @@map("currency_configs")
}

model IPWhitelist {
  id              String   @id @default(uuid())
  userId          String
  ip              String
  description     String?  @db.Text
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())

  @@index([userId])
  @@index([isActive])
  @@map("ip_whitelists")
}

model GeoBlockRule {
  id              String   @id @default(uuid())
  userId          String?
  partnerId       String?
  country         String
  action          String   // allow | block | require_verification
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())

  @@index([userId])
  @@index([partnerId])
  @@index([country])
  @@index([isActive])
  @@map("geo_block_rules")
}

model SecurityAuditLog {
  id              String   @id @default(uuid())
  userId          String?
  ip              String
  country         String?
  action          String
  resource        String
  status          String   // success | failed | blocked
  reason          String?  @db.Text
  metadata        Json?
  createdAt       DateTime @default(now())

  @@index([userId])
  @@index([ip])
  @@index([action])
  @@index([status])
  @@index([createdAt])
  @@map("security_audit_logs")
}

model TwoFactorAuth {
  id              String   @id @default(uuid())
  userId          String   @unique
  totpEnabled     Boolean  @default(false)
  totpSecret      String?
  smsEnabled      Boolean  @default(false)
  smsPhoneNumber  String?
  emailEnabled    Boolean  @default(false)
  backupCodes     String[]
  createdAt       DateTime @default(now())
  verifiedAt      DateTime?

  @@index([userId])
  @@map("two_factor_auth")
}

// Phase 8.4: Developer Marketplace & AI Runtime

model Developer {
  id                String   @id @default(uuid())
  userId            String   @unique
  email             String
  name              String
  company           String?
  status            String   @default("pending") // pending | verified | suspended | rejected
  verificationLevel String   @default("email") // email | kyc | full
  tier              String   @default("free") // free | pro | enterprise
  walletId          String   @unique
  profile           Json     // DeveloperProfile
  portfolio         Json     // DeveloperPortfolio
  kycData           Json?    // KYCData
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  apps              App[]
  wallet            DeveloperWallet?
  withdrawals       Withdrawal[]

  @@index([userId])
  @@index([status])
  @@index([verificationLevel])
  @@map("developers")
}

model App {
  id              String   @id @default(uuid())
  developerId     String
  name            String
  slug            String   @unique
  description     String   @db.Text
  longDescription String?  @db.Text
  category        String
  tags            String[]
  version         String   @default("1.0.0")
  status          String   @default("draft") // draft | pending | reviewing | approved | rejected | published | suspended
  accessLevel     String   @default("private") // public | private | premium | enterprise
  licenseType     String   @default("closed_source") // open_source | closed_source | commercial | custom
  pricing         Json     // Pricing
  sourceCode      String?  @db.Text
  repository      String?
  icon            String?
  screenshots     String[]
  video           String?
  documentation  String?  @db.Text
  requirements    String[]
  features        String[]
  changelog       String?  @db.Text
  licenseKey      String?
  usageTokens     Int?
  totalDownloads Int      @default(0)
  totalRevenue    Float    @default(0)
  rating          Float    @default(0)
  reviews         Int      @default(0)
  metadata        Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  publishedAt     DateTime?

  // Relations
  developer       Developer @relation(fields: [developerId], references: [id], onDelete: Cascade)
  versions        AppVersion[]
  installations   AppInstallation[]
  appReviews      AppReview[]
  revenueShares   RevenueShare[]
  scanResults     CodeScanResult[]

  @@index([developerId])
  @@index([status])
  @@index([category])
  @@index([slug])
  @@map("apps")
}

model AppVersion {
  id              String   @id @default(uuid())
  appId           String
  version         String
  status          String   @default("draft") // draft | published | deprecated | archived
  compatibility   String   @default("backward_compatible") // backward_compatible | breaking | major | minor | patch
  changelog       String?  @db.Text
  sourceCode      String   @db.Text
  runtimeConfig   Json?
  apiTokens       String[]
  endpoints       String[]
  isStable        Boolean  @default(false)
  isDefault        Boolean  @default(false)
  createdAt       DateTime @default(now())
  publishedAt     DateTime?
  deprecatedAt    DateTime?

  // Relations
  app             App      @relation(fields: [appId], references: [id], onDelete: Cascade)
  appTokens       AppToken[]

  @@unique([appId, version])
  @@index([appId])
  @@index([status])
  @@map("app_versions")
}

model AppToken {
  id                String   @id @default(uuid())
  appId             String
  version           String
  token             String   @unique
  name              String
  permissions       String[]
  rateLimit         Json     // RateLimit
  isActive          Boolean  @default(true)
  expiresAt         DateTime?
  createdAt         DateTime @default(now())

  // Relations
  appVersion        AppVersion @relation(fields: [appId, version], references: [appId, version], onDelete: Cascade)

  @@index([appId])
  @@index([token])
  @@index([isActive])
  @@map("app_tokens")
}

model AppInstance {
  id              String   @id @default(uuid())
  appId           String
  developerId     String
  version         String
  status          String   @default("pending") // pending | running | stopped | error
  containerId     String?
  runtimeConfig   Json     // RuntimeConfig
  resourceUsage   Json     // ResourceUsage
  endpoint        String   @unique
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  metrics         RuntimeMetrics[]

  @@index([appId])
  @@index([developerId])
  @@index([status])
  @@map("app_instances")
}

model RuntimeMetrics {
  id              String   @id @default(uuid())
  instanceId     String
  cpu             Float
  memory          Float
  storage         Float
  requests        Int      @default(0)
  errors          Int      @default(0)
  latency         Float
  uptime          Int
  timestamp       DateTime @default(now())

  // Relations
  instance       AppInstance @relation(fields: [instanceId], references: [id], onDelete: Cascade)

  @@index([instanceId])
  @@index([timestamp])
  @@map("runtime_metrics")
}

model DeveloperWallet {
  id              String   @id @default(uuid())
  developerId     String   @unique
  balance         Float    @default(0)
  currency        String   @default("USD")
  pendingBalance  Float    @default(0)
  totalEarned     Float    @default(0)
  totalWithdrawn  Float    @default(0)
  lastUpdated     DateTime @default(now())

  // Relations
  developer       Developer @relation(fields: [developerId], references: [id], onDelete: Cascade)

  @@index([developerId])
  @@map("developer_wallets")
}

model RevenueShare {
  id                String   @id @default(uuid())
  transactionId     String
  appId             String
  developerId       String
  userId            String
  amount            Float
  currency          String   @default("USD")
  developerShare    Float
  platformShare     Float
  developerPercentage Float
  platformPercentage Float
  type              String   // subscription | one_time | usage | commission
  status            String   @default("pending") // pending | processing | completed | failed
  processedAt       DateTime?
  metadata          Json?
  createdAt         DateTime @default(now())

  // Relations
  app               App      @relation(fields: [appId], references: [id], onDelete: Cascade)

  @@index([appId])
  @@index([developerId])
  @@index([status])
  @@index([createdAt])
  @@map("revenue_shares")
}

model Withdrawal {
  id              String   @id @default(uuid())
  developerId     String
  amount          Float
  currency        String   @default("USD")
  walletAddress   String?
  bankAccount     String?
  paymentMethod   String   // crypto | bank | paypal | stripe
  status          String   @default("pending") // pending | processing | completed | failed
  processedAt     DateTime?
  transactionHash String?
  createdAt       DateTime @default(now())

  // Relations
  developer       Developer @relation(fields: [developerId], references: [id], onDelete: Cascade)

  @@index([developerId])
  @@index([status])
  @@index([createdAt])
  @@map("withdrawals")
}

model CodeScanResult {
  id              String   @id @default(uuid())
  appId           String
  version         String
  status          String   @default("pending") // pending | scanning | completed | failed
  riskLevel       String   @default("low") // low | medium | high | critical
  issues          Json     // ScanIssue[]
  score           Int      // 0-100
  metadata        Json?
  scannedAt       DateTime @default(now())

  // Relations
  app             App      @relation(fields: [appId], references: [id], onDelete: Cascade)

  @@index([appId])
  @@index([version])
  @@index([riskLevel])
  @@map("code_scan_results")
}

model SecurityAudit {
  id              String   @id @default(uuid())
  appId           String
  developerId     String
  action          String   // publish | update | delete | approve | reject
  scanResultId    String?
  riskLevel       String   @default("low") // low | medium | high | critical
  approved        Boolean  @default(false)
  approvedBy      String?
  notes           String?  @db.Text
  createdAt       DateTime @default(now())

  @@index([appId])
  @@index([developerId])
  @@index([action])
  @@index([createdAt])
  @@map("security_audits")
}

model AppReview {
  id              String   @id @default(uuid())
  appId           String
  userId          String
  rating          Int      // 1-5
  title           String?
  comment         String?  @db.Text
  status          String   @default("pending") // pending | approved | rejected
  helpful         Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  app             App      @relation(fields: [appId], references: [id], onDelete: Cascade)

  @@index([appId])
  @@index([userId])
  @@index([status])
  @@index([rating])
  @@map("app_reviews")
}

model AppInstallation {
  id              String   @id @default(uuid())
  appId           String
  userId          String
  version         String
  instanceId      String?
  status          String   @default("installed") // installed | running | stopped | uninstalled
  installedAt     DateTime @default(now())
  lastUsedAt      DateTime?

  // Relations
  app             App      @relation(fields: [appId], references: [id], onDelete: Cascade)

  @@index([appId])
  @@index([userId])
  @@index([status])
  @@map("app_installations")
}


// Phase 8.5: Matrix Intelligence Federation & Internal Economy

model AIIdentity {
  id              String   @id @default(uuid())
  type            String   // intelligence | app | service | agent
  name            String
  description     String?  @db.Text
  token           String   @unique
  publicKey       String
  capabilities    String[]
  endpoint        String?
  metadata        Json?
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([type])
  @@index([token])
  @@index([isActive])
  @@map("ai_identities")
}

model AICommunication {
  id              String   @id @default(uuid())
  fromAI          String
  toAI            String
  message         String   @db.Text
  payload         Json
  status          String   // pending | active | completed | failed
  response        Json?
  timestamp       DateTime @default(now())

  @@index([fromAI])
  @@index([toAI])
  @@index([status])
  @@map("ai_communications")
}

model ServiceRequest {
  id              String   @id @default(uuid())
  requesterAI     String
  providerAI      String
  service         String
  parameters      Json
  status          String   // pending | processing | completed | failed | rejected
  cost            Float?
  currency        String?
  result          Json?
  error           String?  @db.Text
  createdAt       DateTime @default(now())
  completedAt     DateTime?

  @@index([requesterAI])
  @@index([providerAI])
  @@index([status])
  @@map("service_requests")
}

model DependencyRelation {
  id              String   @id @default(uuid())
  fromAI          String
  toAI            String
  service         String
  isRequired      Boolean  @default(true)
  priority        Int      @default(1)
  createdAt       DateTime @default(now())

  @@index([fromAI])
  @@index([toAI])
  @@map("dependency_relations")
}

model MatrixCoinWallet {
  id              String   @id @default(uuid())
  accountId       String   @unique
  accountType     String   // user | developer | ai | app | system
  balance         Float    @default(0)
  lockedBalance   Float    @default(0)
  totalEarned     Float    @default(0)
  totalSpent      Float    @default(0)
  lastUpdated     DateTime @default(now())

  @@index([accountId])
  @@index([accountType])
  @@map("matrix_coin_wallets")
}

model MatrixCoinTransaction {
  id              String   @id @default(uuid())
  fromAccountId   String
  fromAccountType String
  toAccountId     String
  toAccountType   String
  amount          Float
  currency        String   @default("MXC")
  type            String   // transfer | payment | reward | fee | conversion | mint | burn
  status          String   @default("pending") // pending | processing | completed | failed | reversed
  description     String?  @db.Text
  metadata        Json?
  blockHash       String?
  transactionHash String?
  createdAt       DateTime @default(now())
  processedAt     DateTime?

  @@index([fromAccountId])
  @@index([toAccountId])
  @@index([status])
  @@index([type])
  @@index([createdAt])
  @@map("matrix_coin_transactions")
}

model CurrencyConversion {
  id              String   @id @default(uuid())
  accountId       String
  fromCurrency    String
  toCurrency      String
  fromAmount      Float
  toAmount        Float
  exchangeRate    Float
  fee             Float
  status          String   // pending | processing | completed | failed
  createdAt       DateTime @default(now())
  completedAt     DateTime?

  @@index([accountId])
  @@index([status])
  @@map("currency_conversions")
}

model AIContract {
  id              String   @id @default(uuid())
  fromAI          String
  toAI            String
  type            String   // service | payment | data | computation
  service         String
  description     String   @db.Text
  price           Float
  currency        String   @default("MXC")
  duration        Int?     // seconds
  conditions      Json     // ContractCondition[]
  status          String   @default("active") // active | completed | failed | cancelled
  result          Json?
  error           String?  @db.Text
  metadata        Json?
  createdAt       DateTime @default(now())
  completedAt     DateTime?

  @@index([fromAI])
  @@index([toAI])
  @@index([status])
  @@index([type])
  @@map("ai_contracts")
}

model LedgerEntry {
  id              String   @id @default(uuid())
  type            String   // ai_contract | transaction | conversion
  entityId        String
  action          String
  data            Json
  timestamp       DateTime @default(now())

  @@index([type])
  @@index([entityId])
  @@index([timestamp])
  @@map("ledger_entries")
}

model AppAICall {
  id              String   @id @default(uuid())
  appId           String
  aiId            String
  service         String
  input           Json
  output          Json?
  cost            Float
  currency        String   @default("MXC")
  status          String   @default("pending") // pending | processing | completed | failed
  createdAt       DateTime @default(now())
  completedAt     DateTime?

  @@index([appId])
  @@index([aiId])
  @@index([status])
  @@map("app_ai_calls")
}

model AIReputation {
  id              String   @id @default(uuid())
  aiId            String   @unique
  rating          Float    @default(5.0) // 0-5
  accuracy        Float    @default(100) // 0-100
  performance     Float    @default(100) // 0-100
  userSatisfaction Float   @default(100) // 0-100
  totalCalls      Int      @default(0)
  successfulCalls Int      @default(0)
  failedCalls     Int      @default(0)
  averageLatency  Float    @default(0) // milliseconds
  rank            Int      @default(0)
  status          String   @default("active") // active | suspended | deprecated
  lastUpdated     DateTime @default(now())

  @@index([aiId])
  @@index([rank])
  @@index([status])
  @@map("ai_reputations")
}

// Phase 8.6: Professional Enhancements & Global Competition Features

model InvoiceTemplate {
  id              String   @id @default(uuid())
  name            String
  type            String   // default | minimal | detailed | custom
  template        String   @db.Text
  logo            String?
  colors          Json?
  footer          String?  @db.Text
  isDefault       Boolean  @default(false)
  createdAt       DateTime @default(now())

  @@index([type])
  @@index([isDefault])
  @@map("invoice_templates")
}

model PaymentRetry {
  id              String   @id @default(uuid())
  invoiceId       String
  attempt         Int
  scheduledAt     DateTime
  status          String   @default("pending") // pending | succeeded | failed | expired
  error           String?  @db.Text
  createdAt       DateTime @default(now())
  processedAt     DateTime?

  @@index([invoiceId])
  @@index([status])
  @@index([scheduledAt])
  @@map("payment_retries")
}

model DunningRule {
  id              String   @id @default(uuid())
  name            String
  daysAfterFailure Int
  action          String   // email | retry | suspend | cancel
  emailTemplate   String?  @db.Text
  isActive        Boolean  @default(true)

  @@index([isActive])
  @@map("dunning_rules")
}

model GitRepository {
  id              String   @id @default(uuid())
  appId           String
  provider        String   // github | gitlab | bitbucket | custom
  repositoryUrl   String
  branch          String   @default("main")
  accessToken     String   // Encrypted
  webhookSecret   String?
  createdAt       DateTime @default(now())

  @@index([appId])
  @@index([provider])
  @@map("git_repositories")
}

model CICDPipeline {
  id              String   @id @default(uuid())
  appId           String
  repositoryId    String
  status          String   @default("pending") // pending | running | success | failed | cancelled
  stages          Json     // PipelineStage[]
  startedAt       DateTime?
  completedAt     DateTime?
  error           String?  @db.Text

  @@index([appId])
  @@index([repositoryId])
  @@index([status])
  @@map("cicd_pipelines")
}

model TestResult {
  id              String   @id @default(uuid())
  pipelineId     String
  testSuite       String
  status          String   @default("pending") // pending | running | passed | failed
  passed          Int      @default(0)
  failed          Int      @default(0)
  skipped         Int      @default(0)
  duration        Int      @default(0) // milliseconds
  logs            String[] @db.Text
  createdAt       DateTime @default(now())

  @@index([pipelineId])
  @@index([status])
  @@map("test_results")
}

model Deployment {
  id              String   @id @default(uuid())
  appId           String
  version         String
  status          String   @default("pending") // pending | deploying | deployed | failed | rolled_back
  environment     String   // development | staging | production
  deployedAt      DateTime?
  rolledBackAt     DateTime?
  error           String?  @db.Text

  @@index([appId])
  @@index([status])
  @@index([environment])
  @@map("deployments")
}

model ComplianceCheck {
  id              String   @id @default(uuid())
  standard        String   // GDPR | SOC2 | HIPAA | ISO27001 | PCI-DSS
  status          String   @default("pending") // compliant | non_compliant | pending | expired
  checks          Json     // ComplianceCheckItem[]
  score           Int      @default(0) // 0-100
  lastChecked     DateTime @default(now())
  nextCheck       DateTime
  notes           String?  @db.Text

  @@index([standard])
  @@index([status])
  @@index([lastChecked])
  @@map("compliance_checks")
}

model DataRetentionRule {
  id              String   @id @default(uuid())
  dataType        String
  retentionPeriod String   // 30_days | 90_days | 1_year | 7_years | indefinite
  autoDelete      Boolean  @default(false)
  archived        Boolean  @default(false)
  createdAt       DateTime @default(now())

  @@index([dataType])
  @@map("data_retention_rules")
}

model Trace {
  id              String   @id @default(uuid())
  traceId         String
  spanId          String
  parentSpanId    String?
  service         String
  operation       String
  startTime       DateTime
  endTime         DateTime?
  duration        Int?     // milliseconds
  tags            Json
  logs            Json?    // TraceLog[]

  @@index([traceId])
  @@index([spanId])
  @@index([service])
  @@index([startTime])
  @@map("traces")
}

model MonitoringDashboard {
  id              String   @id @default(uuid())
  name            String
  widgets         Json     // DashboardWidget[]
  createdAt       DateTime @default(now())

  @@index([name])
  @@map("monitoring_dashboards")
}

model MLInsight {
  id              String   @id @default(uuid())
  type            String   // forecast | anomaly | classification | clustering
  metric          String
  prediction      Float
  confidence      Int      @default(0) // 0-100
  factors         String[]
  createdAt       DateTime @default(now())

  @@index([metric])
  @@index([type])
  @@index([createdAt])
  @@map("ml_insights")
}

model AnomalyDetection {
  id              String   @id @default(uuid())
  metric          String
  type            String   // spike | drop | outlier | pattern_change
  value           Float
  expectedValue   Float
  deviation       Float
  severity        String   // low | medium | high | critical
  detectedAt      DateTime @default(now())

  @@index([metric])
  @@index([severity])
  @@index([detectedAt])
  @@map("anomaly_detections")
}

model PredictiveForecast {
  id              String   @id @default(uuid())
  metric          String
  predictions     Json     // ForecastPoint[]
  confidence      Int      @default(0) // 0-100
  generatedAt     DateTime @default(now())

  @@index([metric])
  @@index([generatedAt])
  @@map("predictive_forecasts")
}

// Phase 8.6: Professional Enhancements & Global Competition Features

model InvoiceTemplate {
  id              String   @id @default(uuid())
  name            String
  type            String   // default | minimal | detailed | custom
  template        String   @db.Text
  logo            String?
  colors          Json?
  footer          String?  @db.Text
  isDefault       Boolean  @default(false)
  createdAt       DateTime @default(now())

  @@index([type])
  @@index([isDefault])
  @@map("invoice_templates")
}

model PaymentRetry {
  id              String   @id @default(uuid())
  invoiceId       String
  attempt         Int
  scheduledAt     DateTime
  status          String   @default("pending") // pending | succeeded | failed | expired
  error           String?  @db.Text
  createdAt       DateTime @default(now())
  processedAt     DateTime?

  @@index([invoiceId])
  @@index([status])
  @@index([scheduledAt])
  @@map("payment_retries")
}

model DunningRule {
  id              String   @id @default(uuid())
  name            String
  daysAfterFailure Int
  action          String   // email | retry | suspend | cancel
  emailTemplate   String?  @db.Text
  isActive        Boolean  @default(true)

  @@index([isActive])
  @@map("dunning_rules")
}

model GitRepository {
  id              String   @id @default(uuid())
  appId           String
  provider        String   // github | gitlab | bitbucket | custom
  repositoryUrl   String
  branch          String   @default("main")
  accessToken     String   // Encrypted
  webhookSecret   String?
  createdAt       DateTime @default(now())

  @@index([appId])
  @@index([provider])
  @@map("git_repositories")
}

model CICDPipeline {
  id              String   @id @default(uuid())
  appId           String
  repositoryId    String
  status          String   @default("pending") // pending | running | success | failed | cancelled
  stages          Json     // PipelineStage[]
  startedAt       DateTime?
  completedAt     DateTime?
  error           String?  @db.Text

  @@index([appId])
  @@index([repositoryId])
  @@index([status])
  @@map("cicd_pipelines")
}

model TestResult {
  id              String   @id @default(uuid())
  pipelineId     String
  testSuite       String
  status          String   @default("pending") // pending | running | passed | failed
  passed          Int      @default(0)
  failed          Int      @default(0)
  skipped         Int      @default(0)
  duration        Int      @default(0) // milliseconds
  logs            String[] @db.Text
  createdAt       DateTime @default(now())

  @@index([pipelineId])
  @@index([status])
  @@map("test_results")
}

model Deployment {
  id              String   @id @default(uuid())
  appId           String
  version         String
  status          String   @default("pending") // pending | deploying | deployed | failed | rolled_back
  environment     String   // development | staging | production
  deployedAt      DateTime?
  rolledBackAt     DateTime?
  error           String?  @db.Text

  @@index([appId])
  @@index([status])
  @@index([environment])
  @@map("deployments")
}

model ComplianceCheck {
  id              String   @id @default(uuid())
  standard        String   // GDPR | SOC2 | HIPAA | ISO27001 | PCI-DSS
  status          String   @default("pending") // compliant | non_compliant | pending | expired
  checks          Json     // ComplianceCheckItem[]
  score           Int      @default(0) // 0-100
  lastChecked     DateTime @default(now())
  nextCheck       DateTime
  notes           String?  @db.Text

  @@index([standard])
  @@index([status])
  @@index([lastChecked])
  @@map("compliance_checks")
}

model DataRetentionRule {
  id              String   @id @default(uuid())
  dataType        String
  retentionPeriod String   // 30_days | 90_days | 1_year | 7_years | indefinite
  autoDelete      Boolean  @default(false)
  archived        Boolean  @default(false)
  createdAt       DateTime @default(now())

  @@index([dataType])
  @@map("data_retention_rules")
}

model Trace {
  id              String   @id @default(uuid())
  traceId         String
  spanId          String
  parentSpanId    String?
  service         String
  operation       String
  startTime       DateTime
  endTime         DateTime?
  duration        Int?     // milliseconds
  tags            Json
  logs            Json?    // TraceLog[]

  @@index([traceId])
  @@index([spanId])
  @@index([service])
  @@index([startTime])
  @@map("traces")
}

model MonitoringDashboard {
  id              String   @id @default(uuid())
  name            String
  widgets         Json     // DashboardWidget[]
  createdAt       DateTime @default(now())

  @@index([name])
  @@map("monitoring_dashboards")
}

model MLInsight {
  id              String   @id @default(uuid())
  type            String   // forecast | anomaly | classification | clustering
  metric          String
  prediction      Float
  confidence      Int      @default(0) // 0-100
  factors         String[]
  createdAt       DateTime @default(now())

  @@index([metric])
  @@index([type])
  @@index([createdAt])
  @@map("ml_insights")
}

model AnomalyDetection {
  id              String   @id @default(uuid())
  metric          String
  type            String   // spike | drop | outlier | pattern_change
  value           Float
  expectedValue   Float
  deviation       Float
  severity        String   // low | medium | high | critical
  detectedAt      DateTime @default(now())

  @@index([metric])
  @@index([severity])
  @@index([detectedAt])
  @@map("anomaly_detections")
}

model PredictiveForecast {
  id              String   @id @default(uuid())
  metric          String
  predictions     Json     // ForecastPoint[]
  confidence      Int      @default(0) // 0-100
  generatedAt     DateTime @default(now())

  @@index([metric])
  @@index([generatedAt])
  @@map("predictive_forecasts")
}

// Phase 9: Global Deployment & Domains Network

model GlobalDeployment {
  id              String   @id @default(uuid())
  name            String
  type            String   // frontend | backend | database | cdn | full_stack
  provider        String   // vercel | firebase | cloudflare | aws | gcp | azure | custom
  region          String   // EU | US | ASIA | AFRICA | OCEANIA
  status          String   @default("pending") // pending | deploying | deployed | failed | rolled_back
  config          Json     // DeploymentConfig
  endpoints       Json     // DeploymentEndpoints
  deployedAt      DateTime?
  failedAt        DateTime?
  error           String?  @db.Text
  metadata        Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([region])
  @@index([provider])
  @@index([status])
  @@map("global_deployments")
}

model Domain {
  id              String   @id @default(uuid())
  name            String   @unique
  status          String   @default("pending") // pending | active | expired | suspended
  provider        String   // cloudflare | godaddy | namecheap | custom
  expiresAt       DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([status])
  @@index([provider])
  @@map("domains")
}

model SSLCertificate {
  id              String   @id @default(uuid())
  domainId        String
  status          String   @default("pending") // pending | issued | expired | revoked
  issuer          String
  issuedAt        DateTime
  expiresAt       DateTime
  autoRenew       Boolean  @default(true)
  certificateChain String?  @db.Text
  privateKey      String?  @db.Text // Encrypted
  createdAt       DateTime @default(now())

  @@index([domainId])
  @@index([status])
  @@index([expiresAt])
  @@map("ssl_certificates")
}

model DNSRecord {
  id              String   @id @default(uuid())
  domainId        String
  type            String   // A | AAAA | CNAME | MX | TXT | NS | SRV
  name            String
  value           String
  ttl             Int      @default(3600)
  priority        Int?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([domainId])
  @@index([type])
  @@map("dns_records")
}

model EdgeNode {
  id              String   @id @default(uuid())
  region          String
  provider        String   // cloudflare | fastly | aws | gcp
  status          String   @default("active") // active | inactive | maintenance | overloaded
  location        Json     // { city, country, latitude, longitude }
  performance     Json     // { latency, throughput, errorRate, uptime }
  lastChecked     DateTime @default(now())

  @@index([region])
  @@index([status])
  @@map("edge_nodes")
}

model CDNConfig {
  id              String   @id @default(uuid())
  domainId        String
  cacheStrategy   String   // cache_all | cache_static | cache_dynamic | no_cache
  cacheTTL        Int      @default(3600)
  compression     Boolean  @default(true)
  minification    Boolean  @default(true)
  edgeNodes       String[]
  routingRules    Json     // RoutingRule[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([domainId])
  @@map("cdn_configs")
}

model GlobalMonitor {
  id              String   @id @default(uuid())
  region          String
  deploymentId    String
  status          String   @default("healthy") // healthy | degraded | down | recovering
  metrics         Json     // MonitorMetrics
  lastChecked     DateTime @default(now())

  @@index([region])
  @@index([deploymentId])
  @@index([status])
  @@map("global_monitors")
}

model Incident {
  id              String   @id @default(uuid())
  region          String
  deploymentId    String
  severity        String   // low | medium | high | critical
  status          String   @default("open") // open | investigating | resolved
  description     String   @db.Text
  affectedServices String[]
  startTime       DateTime @default(now())
  endTime         DateTime?
  resolution      String?  @db.Text

  @@index([region])
  @@index([status])
  @@index([severity])
  @@map("incidents")
}

model RegionalConfig {
  id              String   @id @default(uuid())
  region          String   @unique
  currency        String   // USD | EUR | AED | CNY | GBP | JPY | SAR | INR
  language        String   // en | ar | nl | zh | fr | de | es | ja
  timezone        String   // UTC | America/New_York | Europe/London | Asia/Dubai | Asia/Shanghai | Asia/Tokyo
  taxRegion       String   // EU | US | GCC | ASIA | OTHER
  taxRate         Float
  pricing         Json     // RegionalPricing
  localization    Json     // Localization
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([region])
  @@map("regional_configs")
}

model PublicAPIKey {
  id              String   @id @default(uuid())
  key             String   @unique
  type            String   // developer | partner | public | trial
  status          String   @default("active") // active | suspended | revoked
  userId          String?
  partnerId       String?
  name            String
  description     String?  @db.Text
  rateLimit       Json     // { requestsPerMinute, requestsPerHour, requestsPerDay }
  permissions     String[]
  usage           Json     // { totalRequests, successfulRequests, failedRequests, totalTokens, totalCost }
  createdAt       DateTime @default(now())
  lastUsedAt      DateTime?
  expiresAt       DateTime?

  @@index([userId])
  @@index([partnerId])
  @@index([status])
  @@index([type])
  @@map("public_api_keys")
}

model PublicUsageStats {
  id              String   @id @default(uuid())
  keyId           String
  date            DateTime
  requests        Int      @default(0)
  successfulRequests Int   @default(0)
  failedRequests  Int      @default(0)
  tokens          Int      @default(0)
  cost            Float    @default(0)
  latency         Float    @default(0) // average milliseconds
  errorRate       Float    @default(0) // percentage

  @@index([keyId])
  @@index([date])
  @@map("public_usage_stats")
}

model PublicPerformanceReport {
  id              String   @id @default(uuid())
  keyId           String
  period          String   // daily | weekly | monthly
  startDate       DateTime
  endDate         DateTime
  stats           Json     // PerformanceStats
  generatedAt     DateTime @default(now())

  @@index([keyId])
  @@index([period])
  @@index([generatedAt])
  @@map("public_performance_reports")
}

// Phase 9.1: Global Compliance & Legal Standards

model ComplianceCheck {
  id              String   @id @default(uuid())
  standard        String   // GDPR | CCPA | PIPL | GCC | ISO27001 | SOC2 | HIPAA | PCI-DSS
  region          String   // EU | US | ASIA | GCC | GLOBAL
  status          String   @default("pending") // compliant | non_compliant | pending | breached
  checks          Json     // ComplianceCheckItem[]
  score           Int      @default(0) // 0-100
  lastChecked     DateTime @default(now())
  nextCheck       DateTime
  notes           String?  @db.Text
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([standard])
  @@index([region])
  @@index([status])
  @@map("compliance_checks")
}

model ComplianceBreach {
  id              String   @id @default(uuid())
  checkId         String
  severity        String   // low | medium | high | critical
  description     String   @db.Text
  detectedAt      DateTime @default(now())
  resolvedAt      DateTime?
  resolution      String?  @db.Text

  @@index([checkId])
  @@index([severity])
  @@index([detectedAt])
  @@map("compliance_breaches")
}

model DataResidencyRule {
  id              String   @id @default(uuid())
  region          String   // EU | US | ASIA | GCC | CUSTOM
  dataType        String   // user_data | transaction_data | ai_data | log_data | metadata
  storageLocation String   // frankfurt | iowa | singapore | dubai | custom
  encryptionRequired Boolean @default(true)
  transferAllowed Boolean  @default(false)
  transferConditions String[] // scc | explicit_consent | safeguards
  sccRequired     Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([region])
  @@index([dataType])
  @@map("data_residency_rules")
}

model DataTransfer {
  id              String   @id @default(uuid())
  fromRegion      String
  toRegion        String
  dataType        String
  transferMethod  String   // scc | adequacy | safeguards | explicit_consent
  status          String   @default("pending") // pending | approved | rejected | completed
  sccSigned       Boolean  @default(false)
  consentObtained Boolean  @default(false)
  transferredAt   DateTime?
  createdAt       DateTime @default(now())

  @@index([fromRegion])
  @@index([toRegion])
  @@index([status])
  @@map("data_transfers")
}

model SCCAgreement {
  id              String   @id @default(uuid())
  transferId      String
  fromRegion      String
  toRegion        String
  signedAt        DateTime @default(now())
  expiresAt       DateTime
  status          String   @default("active") // active | expired | revoked
  documentUrl     String?

  @@index([transferId])
  @@index([status])
  @@map("scc_agreements")
}

model SecurityCertification {
  id              String   @id @default(uuid())
  type            String   // ISO27001 | SOC2 | HIPAA | PCI-DSS | GDPR | CUSTOM
  status          String   @default("pending") // pending | issued | expired | revoked | suspended
  issuer          String
  certificateNumber String
  issuedAt        DateTime
  expiresAt       DateTime
  autoRenew       Boolean  @default(true)
  documentUrl     String?
  notes           String?  @db.Text
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([type])
  @@index([status])
  @@index([expiresAt])
  @@map("security_certifications")
}

model CertificationRequirement {
  id              String   @id @default(uuid())
  certificationId String
  name            String
  description     String   @db.Text
  status          String   @default("pending") // pending | met | not_met
  evidence        String?  @db.Text
  checkedAt       DateTime?

  @@index([certificationId])
  @@index([status])
  @@map("certification_requirements")
}

model LegalDocument {
  id              String   @id @default(uuid())
  type            String   // terms_of_service | privacy_policy | cookie_policy | developer_agreement | dpa | refund_policy
  language        String   // en | ar | nl | zh | fr | de | es | ja
  version         String   @default("1.0.0")
  status          String   @default("draft") // draft | published | archived
  title           String
  content         String   @db.Text
  effectiveDate   DateTime @default(now())
  expiresAt       DateTime?
  metadata        Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([type])
  @@index([language])
  @@index([status])
  @@map("legal_documents")
}

model DocumentVersion {
  id              String   @id @default(uuid())
  documentId      String
  version         String
  content         String   @db.Text
  changes         String[]
  effectiveDate   DateTime @default(now())
  createdAt       DateTime @default(now())

  @@index([documentId])
  @@index([version])
  @@map("document_versions")
}

model AuditLog {
  id              String   @id @default(uuid())
  action          String   // data_access | admin_action | api_call | data_modification | data_deletion | user_login | permission_change
  userId          String?
  resourceId      String?
  resourceType    String?
  ipAddress       String
  userAgent       String?
  country         String?
  timestamp       DateTime @default(now())
  details         Json
  severity        String   // low | medium | high | critical
  hash            String   // Immutable hash
  previousHash    String?

  @@index([userId])
  @@index([resourceId])
  @@index([action])
  @@index([timestamp])
  @@index([severity])
  @@map("audit_logs")
}

model AuditReport {
  id              String   @id @default(uuid())
  type            String   // compliance | security | data_access | admin_actions
  startDate       DateTime
  endDate         DateTime
  format          String   // json | csv | pdf | xlsx
  generatedAt     DateTime @default(now())
  data            Json
  hash            String   // Immutable hash

  @@index([type])
  @@index([generatedAt])
  @@map("audit_reports")
}

model AIGovernancePolicy {
  id              String   @id @default(uuid())
  standard        String   // EU_AI_ACT | OECD_AI_PRINCIPLES | CUSTOM
  category        String   // high_risk | limited_risk | minimal_risk | prohibited
  name            String
  description     String   @db.Text
  requirements    String[]
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([standard])
  @@index([category])
  @@map("ai_governance_policies")
}

model AIBiasDetection {
  id              String   @id @default(uuid())
  aiId            String
  biasType        String   // gender | racial | age | socioeconomic | other
  severity        String   // low | medium | high | critical
  description     String   @db.Text
  evidence        Json
  detectedAt      DateTime @default(now())
  resolvedAt      DateTime?

  @@index([aiId])
  @@index([biasType])
  @@index([severity])
  @@index([detectedAt])
  @@map("ai_bias_detections")
}

model EthicsViolationReport {
  id              String   @id @default(uuid())
  aiId            String
  violation       String   // bias | discrimination | privacy | transparency | accountability
  description     String   @db.Text
  severity        String   // low | medium | high | critical
  status          String   @default("open") // open | investigating | resolved
  reportedAt      DateTime @default(now())
  resolvedAt      DateTime?
  resolution      String?  @db.Text

  @@index([aiId])
  @@index([violation])
  @@index([status])
  @@index([severity])
  @@map("ethics_violation_reports")
}

// Phase 9.2: Matrix Core Governance & Self-Evolution Systems

model Innovation {
  id              String   @id @default(uuid())
  type            String   // feature | bug_fix | performance | security | ux | api
  title           String
  description     String   @db.Text
  priority        String   // low | medium | high | critical
  status          String   @default("proposed") // proposed | approved | in_progress | completed | rejected
  source          String   // telemetry | feedback | market_data | ai_analysis
  data            Json
  impact          Json     // { users, revenue, performance }
  proposedAt      DateTime @default(now())
  approvedAt      DateTime?
  completedAt     DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([status])
  @@index([type])
  @@index([priority])
  @@map("innovations")
}

model Feedback {
  id              String   @id @default(uuid())
  userId          String
  type            String   // feature_request | bug_report | improvement | complaint
  content         String   @db.Text
  rating          Int?
  metadata        Json?
  createdAt       DateTime @default(now())

  @@index([userId])
  @@index([type])
  @@map("feedback")
}

model AppEvolution {
  id              String   @id @default(uuid())
  appId           String
  status          String   // monitoring | analyzing | recommending | updating | completed
  metrics         Json     // { performance, userSatisfaction, usage, errorRate }
  recommendations Json     // Recommendation[]
  lastAnalyzed    DateTime @default(now())
  nextAnalysis    DateTime

  @@index([appId])
  @@index([status])
  @@map("app_evolutions")
}

model Threat {
  id              String   @id @default(uuid())
  type            String   // ddos | malware | sql_injection | xss | csrf | brute_force | unauthorized_access | data_breach
  severity        String   // low | medium | high | critical
  source          Json     // { ip, country, userAgent }
  target          Json     // { endpoint, resource }
  detectedAt      DateTime @default(now())
  mitigatedAt     DateTime?
  status          String   @default("detected") // detected | mitigated | resolved
  mitigation      String[] // block | rate_limit | challenge | alert | quarantine

  @@index([type])
  @@index([severity])
  @@index([status])
  @@map("threats")
}

model Vulnerability {
  id              String   @id @default(uuid())
  name            String
  description     String   @db.Text
  severity        String   // low | medium | high | critical
  component       String
  cve             String?
  detectedAt      DateTime @default(now())
  patchedAt       DateTime?
  status          String   @default("detected") // detected | patching | patched | resolved

  @@index([severity])
  @@index([status])
  @@map("vulnerabilities")
}

model RightsAndResponsibilities {
  id              String   @id @default(uuid())
  partyType       String   // platform | user | vendor | developer | partner
  rights          Json     // Right[]
  responsibilities Json     // Responsibility[]
  effectiveDate   DateTime @default(now())
  expiresAt       DateTime?
  version         String   @default("1.0.0")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([partyType])
  @@index([version])
  @@map("rights_and_responsibilities")
}

model PublicIdentity {
  id              String   @id @default(uuid())
  section         String   // about | vision | mission | values | goals | structure | sitemap
  language        String   // en | ar | nl | zh | fr | de | es | ja
  title           String
  content         String   @db.Text
  order           Int      @default(0)
  isActive        Boolean  @default(true)
  parentId        String?
  metadata        Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([section])
  @@index([language])
  @@index([isActive])
  @@map("public_identities")
}

model SiteMap {
  id              String   @id @default(uuid())
  name            String
  url             String
  description     String
  category        String
  order           Int      @default(0)
  parentId        String?
  isActive        Boolean  @default(true)

  @@index([category])
  @@index([isActive])
  @@map("site_map")
}

model MatrixLicense {
  id              String   @id @default(uuid())
  type            String   // application | ai | partner | developer | custom
  entityId        String
  entityType      String   // app | ai | partner | developer
  status          String   @default("pending") // pending | active | expired | suspended | revoked
  licenseKey      String   @unique
  token           String?
  period          String   // monthly | yearly | lifetime | custom
  startDate       DateTime @default(now())
  endDate         DateTime?
  autoRenew       Boolean  @default(true)
  metadata        Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([type])
  @@index([entityId])
  @@index([status])
  @@index([licenseKey])
  @@map("matrix_licenses")
}

model LicenseVerification {
  id              String   @id @default(uuid())
  licenseId       String
  licenseKey      String
  verified        Boolean  @default(false)
  verifiedAt      DateTime @default(now())
  ipAddress       String?
  userAgent       String?
  error           String?

  @@index([licenseId])
  @@index([licenseKey])
  @@map("license_verifications")
}

model SmartContract {
  id              String   @id @default(uuid())
  type            String   // sale | lease | license | development | maintenance | reseller | partner
  matrixLegalId   String   @unique
  parties         Json     // ContractParty[]
  languages       String[] // en | ar | nl | zh | fr | hi | de | es | ja
  primaryLanguage String   @default("en")
  content         Json     // Record<ContractLanguage, string>
  status          String   @default("draft") // draft | pending | signed | active | expired | terminated
  signedAt        DateTime?
  expiresAt       DateTime?
  hash            String   // SHA-256 hash
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([type])
  @@index([matrixLegalId])
  @@index([status])
  @@map("smart_contracts")
}

model ContractAddendum {
  id              String   @id @default(uuid())
  contractId      String
  type            String   // renewal | modification | termination
  content         Json     // Record<ContractLanguage, string>
  signedAt        DateTime @default(now())
  hash            String   // SHA-256 hash

  @@index([contractId])
  @@index([type])
  @@map("contract_addendums")
}

// Phase 9.3: Professional Enhancements & Global Competition Features

model ScalingRule {
  id              String   @id @default(uuid())
  name            String
  metric          String   // cpu | memory | network | requests | latency | cost
  threshold       Float
  action          String   // scale_up | scale_down | scale_out | scale_in | no_action
  minInstances    Int      @default(1)
  maxInstances    Int      @default(100)
  cooldownPeriod  Int      @default(300) // seconds
  strategy        String   // aggressive | balanced | conservative | cost_optimized
  isActive        Boolean  @default(true)

  @@index([metric])
  @@index([isActive])
  @@map("scaling_rules")
}

model ScalingEvent {
  id              String   @id @default(uuid())
  resourceId      String
  resourceType    String
  metric          String
  currentValue    Float
  threshold       Float
  action          String
  instancesBefore Int
  instancesAfter   Int
  costImpact      Float
  triggeredAt     DateTime @default(now())

  @@index([resourceId])
  @@index([metric])
  @@index([triggeredAt])
  @@map("scaling_events")
}

model ResourceOptimization {
  id              String   @id @default(uuid())
  resourceId      String
  resourceType    String
  currentUsage    Json     // { cpu, memory, network, cost }
  recommendedUsage Json    // { cpu, memory, network, cost }
  savings         Float
  confidence      Int      @default(0) // 0-100
  generatedAt     DateTime @default(now())

  @@index([resourceId])
  @@index([generatedAt])
  @@map("resource_optimizations")
}

model Backup {
  id              String   @id @default(uuid())
  resourceId      String
  resourceType    String
  type            String   // full | incremental | differential | snapshot
  status          String   @default("pending") // pending | in_progress | completed | failed
  size            BigInt   @default(0) // bytes
  location        String
  createdAt       DateTime @default(now())
  completedAt     DateTime?
  expiresAt       DateTime
  metadata        Json?

  @@index([resourceId])
  @@index([status])
  @@index([expiresAt])
  @@map("backups")
}

model Recovery {
  id              String   @id @default(uuid())
  backupId        String
  resourceId      String
  resourceType    String
  targetRegion    String
  pointInTime     DateTime
  status          String   @default("pending") // pending | in_progress | completed | failed
  startedAt       DateTime @default(now())
  completedAt     DateTime?
  rto             Int      // Recovery Time Objective (minutes)
  rpo             Int      // Recovery Point Objective (minutes)

  @@index([backupId])
  @@index([resourceId])
  @@index([status])
  @@map("recoveries")
}

model Failover {
  id              String   @id @default(uuid())
  resourceId      String
  resourceType    String
  fromRegion      String
  toRegion        String
  status          String   @default("pending") // pending | in_progress | completed | failed
  triggeredAt     DateTime @default(now())
  completedAt     DateTime?
  rto             Int      // Recovery Time Objective (minutes)

  @@index([resourceId])
  @@index([status])
  @@map("failovers")
}

model ComplianceReport {
  id              String   @id @default(uuid())
  type            String   // monthly | quarterly | annual | ad_hoc
  standard        String
  region          String
  periodStart     DateTime
  periodEnd       DateTime
  score           Int      @default(0) // 0-100
  status          String   @default("pending") // compliant | non_compliant | pending
  breaches        Int      @default(0)
  generatedAt     DateTime @default(now())
  reportUrl       String?

  @@index([standard])
  @@index([region])
  @@index([generatedAt])
  @@map("compliance_reports")
}

model PrivacyImpactAssessment {
  id              String   @id @default(uuid())
  projectId       String
  projectName     String
  dataTypes       String[]
  riskLevel       String   // low | medium | high | critical
  mitigation      String[]
  status          String   @default("pending") // pending | approved | rejected
  assessedAt      DateTime @default(now())

  @@index([projectId])
  @@index([riskLevel])
  @@index([status])
  @@map("privacy_impact_assessments")
}

model DataSubjectRequest {
  id              String   @id @default(uuid())
  userId          String
  right           String   // access | rectification | erasure | portability | objection | restriction
  status          String   @default("pending") // pending | in_progress | completed | rejected
  requestedAt     DateTime @default(now())
  completedAt     DateTime?
  response        String?  @db.Text

  @@index([userId])
  @@index([right])
  @@index([status])
  @@map("data_subject_requests")
}

model ConsentRecord {
  id              String   @id @default(uuid())
  userId          String
  purpose         String
  status          String   @default("granted") // granted | withdrawn | pending | expired
  grantedAt       DateTime?
  withdrawnAt     DateTime?
  expiresAt       DateTime?

  @@index([userId])
  @@index([status])
  @@map("consent_records")
}

model BreachNotification {
  id              String   @id @default(uuid())
  breachId        String
  authority       String
  notifiedAt      DateTime @default(now())
  notificationMethod String // email | portal | api
  response        String?  @db.Text

  @@index([breachId])
  @@index([notifiedAt])
  @@map("breach_notifications")
}

model Prediction {
  id              String   @id @default(uuid())
  type            String   // user_behavior | resource_demand | cost | performance | anomaly
  target          String
  value           Float
  confidence      Int      @default(0) // 0-100
  confidenceLevel String   // low | medium | high | very_high
  predictedAt     DateTime @default(now())
  actualValue     Float?
  accuracy        Float?

  @@index([type])
  @@index([target])
  @@index([predictedAt])
  @@map("predictions")
}

model Forecast {
  id              String   @id @default(uuid())
  resourceId      String
  resourceType    String
  metric          String
  predictions     Json     // { date, value, confidence }[]
  generatedAt     DateTime @default(now())

  @@index([resourceId])
  @@index([generatedAt])
  @@map("forecasts")
}

model AnomalyDetection {
  id              String   @id @default(uuid())
  resourceId      String
  resourceType    String
  type            String   // spike | drop | pattern_change | outlier
  metric          String
  currentValue    Float
  expectedValue   Float
  deviation       Float
  severity        String   // low | medium | high | critical
  detectedAt      DateTime @default(now())
  description     String   @db.Text

  @@index([resourceId])
  @@index([severity])
  @@index([detectedAt])
  @@map("anomaly_detections")
}

model CostAnalysis {
  id              String   @id @default(uuid())
  resourceId      String
  resourceType    String
  periodStart     DateTime
  periodEnd       DateTime
  currentCost     Float
  optimizedCost   Float
  savings         Float
  savingsPercentage Float
  recommendations Json     // CostRecommendation[]
  generatedAt     DateTime @default(now())

  @@index([resourceId])
  @@index([generatedAt])
  @@map("cost_analyses")
}

model CostBudget {
  id              String   @id @default(uuid())
  name            String
  amount          Float
  period          String   // daily | weekly | monthly | yearly
  alertThreshold  Int      @default(80) // percentage
  currentSpend    Float    @default(0)
  alerts          Json     // CostAlert[]
  createdAt       DateTime @default(now())

  @@index([name])
  @@index([period])
  @@map("cost_budgets")
}

model CostAlert {
  id              String   @id @default(uuid())
  budgetId        String
  type            String   // budget_exceeded | unusual_spend | resource_optimization | savings_opportunity
  message         String   @db.Text
  severity        String   // low | medium | high | critical
  triggeredAt     DateTime @default(now())
  resolvedAt      DateTime?

  @@index([budgetId])
  @@index([severity])
  @@index([triggeredAt])
  @@map("cost_alerts")
}

model Benchmark {
  id              String   @id @default(uuid())
  name            String
  metric          String   // response_time | throughput | availability | error_rate | cost
  ourValue        Float
  competitorValue Float
  competitorName  String
  difference      Float
  differencePercentage Float
  benchmarkedAt   DateTime @default(now())

  @@index([metric])
  @@index([benchmarkedAt])
  @@map("benchmarks")
}

model ABTest {
  id              String   @id @default(uuid())
  name            String
  description     String   @db.Text
  status          String   @default("draft") // draft | running | paused | completed | archived
  variants        Json     // ABTestVariant[]
  trafficSplit    Int      @default(50) // percentage to variant A
  startDate       DateTime @default(now())
  endDate         DateTime?
  results         Json?    // ABTestResults

  @@index([status])
  @@index([startDate])
  @@map("ab_tests")
}

model FeatureFlag {
  id              String   @id @default(uuid())
  name            String   @unique
  description     String   @db.Text
  status          String   @default("disabled") // enabled | disabled | gradual_rollout
  rolloutPercentage Int     @default(0) // 0-100
  targetUsers     String[] // user IDs
  enabledAt       DateTime?
  disabledAt      DateTime?

  @@index([status])
  @@index([name])
  @@map("feature_flags")
}

model Competitor {
  id              String   @id @default(uuid())
  name            String   @unique
  type            String   // direct | indirect | potential
  website         String?
  description     String   @db.Text
  features        String[]
  pricing         Json     // { model, price, currency }
  marketShare     Float    @default(0) // percentage
  strengths       String[]
  weaknesses      String[]
  lastUpdated     DateTime @default(now())

  @@index([type])
  @@index([lastUpdated])
  @@map("competitors")
}

model MarketTrendAnalysis {
  id              String   @id @default(uuid())
  market          String
  trend           String   // growing | stable | declining
  growthRate      Float
  totalSize       Float    // market size in USD
  ourPosition     Float    // percentage
  competitors     String[]
  insights        String[]
  analyzedAt      DateTime @default(now())

  @@index([market])
  @@index([analyzedAt])
  @@map("market_trend_analyses")
}

model FeatureGap {
  id              String   @id @default(uuid())
  competitorId    String
  competitorName  String
  feature         String
  type            String   // missing | inferior | superior
  description     String   @db.Text
  priority        String   // low | medium | high | critical
  impact          Json     // { users, revenue }
  detectedAt      DateTime @default(now())

  @@index([competitorId])
  @@index([priority])
  @@index([detectedAt])
  @@map("feature_gaps")
}

model PricingComparison {
  id              String   @id @default(uuid())
  competitorId    String
  competitorName   String
  ourPrice        Float
  competitorPrice Float
  difference      Float
  differencePercentage Float
  recommendation  String   // match | lower | higher | maintain
  comparedAt      DateTime @default(now())

  @@index([competitorId])
  @@index([comparedAt])
  @@map("pricing_comparisons")
}

// Phase 10: Autonomous Evolution & Governance

model CodeIssue {
  id              String   @id @default(uuid())
  filePath        String
  lineNumber      Int
  type            String   // bug | performance | security | refactoring | optimization
  severity        String   // low | medium | high | critical
  description     String   @db.Text
  detectedAt      DateTime @default(now())
  fixedAt         DateTime?
  status          String   @default("detected") // detected | analyzing | generating | reviewing | approved | committed | rejected

  @@index([filePath])
  @@index([severity])
  @@index([status])
  @@map("code_issues")
}

model CodeChange {
  id              String   @id @default(uuid())
  issueId         String
  filePath        String
  oldCode         String   @db.Text
  newCode         String   @db.Text
  description     String   @db.Text
  generatedAt     DateTime @default(now())
  reviewedAt      DateTime?
  approvedAt      DateTime?
  committedAt     DateTime?
  commitHash      String?
  status          String   @default("detected") // detected | analyzing | generating | reviewing | approved | committed | rejected

  @@index([issueId])
  @@index([filePath])
  @@index([status])
  @@map("code_changes")
}

model AutoCommit {
  id              String   @id @default(uuid())
  changes         String[] // CodeChange IDs
  commitMessage   String   @db.Text
  branch          String   @default("auto-improvements")
  createdAt       DateTime @default(now())
  committedAt     DateTime?
  commitHash      String?
  status          String   @default("pending") // pending | committed | failed

  @@index([status])
  @@index([createdAt])
  @@map("auto_commits")
}

model TestCase {
  id              String   @id @default(uuid())
  name            String
  type            String   // unit | integration | e2e | performance | regression | security
  description     String   @db.Text
  filePath        String
  status          String   @default("pending") // pending | running | passed | failed | skipped
  result          String?  // pass | fail | skip
  duration        Int?     // milliseconds
  error           String?  @db.Text
  runAt           DateTime?

  @@index([type])
  @@index([status])
  @@map("test_cases")
}

model TestRun {
  id              String   @id @default(uuid())
  name            String
  type            String   // unit | integration | e2e | performance | regression | security
  tests           String[] // TestCase IDs
  status          String   @default("pending") // pending | running | passed | failed | skipped
  passed          Int      @default(0)
  failed          Int      @default(0)
  skipped         Int      @default(0)
  duration        Int      @default(0) // milliseconds
  startedAt       DateTime @default(now())
  completedAt     DateTime?
  triggeredBy     String   @default("auto") // auto | manual | deployment

  @@index([status])
  @@index([startedAt])
  @@map("test_runs")
}

model TestSuite {
  id              String   @id @default(uuid())
  name            String
  description     String   @db.Text
  tests           String[] // TestCase IDs
  runBeforeDeploy Boolean  @default(true)
  runFrequency    String   @default("always") // always | daily | weekly
  lastRun         DateTime?

  @@index([name])
  @@map("test_suites")
}

model EvolutionCycle {
  id              String   @id @default(uuid())
  cycleNumber     Int      @unique
  status          String   @default("pending") // pending | running | completed | failed
  improvements    String[] // EvolutionImprovement IDs
  performance     Json     // { before, after, improvement }
  startedAt       DateTime @default(now())
  completedAt     DateTime?
  duration        Int      @default(0) // milliseconds

  @@index([cycleNumber])
  @@index([status])
  @@map("evolution_cycles")
}

model EvolutionImprovement {
  id              String   @id @default(uuid())
  category        String   // performance | security | features | optimization | architecture
  title           String
  description     String   @db.Text
  priority        String   // low | medium | high | critical
  impact          Json     // { users, revenue, performance }
  status          String   @default("proposed") // proposed | approved | implemented | rejected
  proposedAt      DateTime @default(now())
  implementedAt   DateTime?

  @@index([category])
  @@index([priority])
  @@index([status])
  @@map("evolution_improvements")
}

model AIPermission {
  id              String   @id @default(uuid())
  aiId            String
  aiName          String
  permission      String   // read | write | execute | modify | delete | monitor
  resource        String
  resourceType    String
  grantedAt       DateTime @default(now())
  expiresAt       DateTime?
  grantedBy       String   @default("system")

  @@index([aiId])
  @@index([permission])
  @@index([resource])
  @@map("ai_permissions")
}

model TrustRelationship {
  id              String   @id @default(uuid())
  fromAI          String
  toAI            String
  trustLevel      String   // low | medium | high | trusted
  accessLevel     String   // public | internal | restricted | confidential
  permissions     String[] // PermissionType[]
  establishedAt   DateTime @default(now())
  lastVerified    DateTime @default(now())

  @@index([fromAI])
  @@index([toAI])
  @@index([trustLevel])
  @@map("trust_relationships")
}

model GovernanceRule {
  id              String   @id @default(uuid())
  framework       String   // CPE | TAG | MCT | SMG
  name            String
  description     String   @db.Text
  rule            String   @db.Text
  priority        String   // low | medium | high | critical
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([framework])
  @@index([isActive])
  @@map("governance_rules")
}

model DigitalConstitution {
  id              String   @id @default(uuid())
  version         String   @unique
  title           String
  principles      String[]
  rights          String[]
  responsibilities String[]
  limits          String[]
  enforcement     String[]
  effectiveDate   DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([version])
  @@map("digital_constitution")
}

model QuantumMemory {
  id              String   @id @default(uuid())
  type            String   // fact | relationship | pattern | experience | knowledge
  content         String   @db.Text
  priority        String   // low | medium | high | critical
  entities        String[] // Entity IDs
  relationships   String[] // Relationship IDs
  coordinates     Json     // { x, y, z }
  strength        Int      @default(50) // 0-100
  lastAccessed    DateTime @default(now())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([type])
  @@index([priority])
  @@index([strength])
  @@map("quantum_memories")
}

model HolographicEntity {
  id              String   @id @default(uuid())
  type            String   // user | ai | app | data | process | event
  name            String
  description     String   @db.Text
  properties      Json
  coordinates     Json     // { x, y, z }
  connections     String[] // Connected entity IDs
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([type])
  @@index([name])
  @@map("holographic_entities")
}

model HolographicConnection {
  id              String   @id @default(uuid())
  fromEntity      String
  toEntity        String
  type            String
  strength        Int      @default(50) // 0-100
  properties      Json
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([fromEntity])
  @@index([toEntity])
  @@index([type])
  @@map("holographic_connections")
}

model MemoryRecall {
  id              String   @id @default(uuid())
  query           String   @db.Text
  memories        String[] // Memory IDs
  entities        String[] // Entity IDs
  connections     String[] // Connection IDs
  confidence      Int      @default(0) // 0-100
  recalledAt      DateTime @default(now())
  duration        Int      @default(0) // milliseconds

  @@index([query])
  @@index([recalledAt])
  @@map("memory_recalls")
}

model AIPlatformConnection {
  id              String   @id @default(uuid())
  platform        String   // huggingface | openai | anthropic | matrix | custom
  apiKey          String?  @db.Text
  endpoint        String?
  status          String   @default("connected") // connected | disconnected | error
  lastSync        DateTime @default(now())
  syncFrequency   Int      @default(60) // minutes
  metadata        Json?

  @@index([platform])
  @@index([status])
  @@map("ai_platform_connections")
}

model SharedKnowledge {
  id              String   @id @default(uuid())
  platform        String   // huggingface | openai | anthropic | matrix | custom
  type            String   // model | dataset | knowledge | pattern | experience
  title           String
  description     String   @db.Text
  content         String   @db.Text
  format          String   // model | dataset | text | json | binary
  sharedAt        DateTime @default(now())
  receivedAt      DateTime?
  status          String   @default("pending") // pending | shared | received | rejected
  metadata        Json?

  @@index([platform])
  @@index([type])
  @@index([status])
  @@map("shared_knowledge")
}

model CollectiveLearning {
  id              String   @id @default(uuid())
  platform        String   // huggingface | openai | anthropic | matrix | custom
  learningType    String   // model | pattern | optimization | knowledge
  input           Json
  output          Json
  learnedAt       DateTime @default(now())
  confidence      Int      @default(50) // 0-100
  applied         Boolean  @default(false)

  @@index([platform])
  @@index([learningType])
  @@index([applied])
  @@map("collective_learnings")
}
